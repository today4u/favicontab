"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(t){var o={};function a(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=o,a.d=function(e,n,t){a.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(n,e){if(1&e&&(n=a(n)),8&e)return n;if(4&e&&"object"===(void 0===n?"undefined":_typeof(n))&&n&&n.__esModule)return n;var t=Object.create(null);if(a.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var o in n)a.d(t,o,function(e){return n[e]}.bind(null,o));return t},a.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(n,"a",n),n},a.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},a.p="",a(a.s="./src/js/favicontab.js")}({"./src/js/const.js":function srcJsConstJs(module,__webpack_exports__,__webpack_require__){eval('__webpack_require__.r(__webpack_exports__);\n/* harmony default export */ __webpack_exports__["default"] = ({\n  idPrefix:        \'bid\',\n  positionPrefix:  \'positions\',\n  notExistPrefix:  \'notexists\',\n  initFolderTitle: \'FaviconTabFolder\',\n  optionsData: {\n    "linkTarget":[\n      {"value":0, "label":"Same Window", "target":"_self" },\n      {"value":1, "label":"New Window",  "target":"_blank"}\n    ],\n    "placement":[\n      {"id":"placement-auto",   "value":0, "label":"Auto"  },\n      {"id":"placement-manual", "value":1, "label":"Manual"}\n    ],\n    "folderType": [\n      {"id":"folderType0", "value":0, "label":"Change Screen"},\n      {"id":"folderType1", "value":1, "label":"Open & Close" }\n    ]\n  }\n});\n\n\n//# sourceURL=webpack:///./src/js/const.js?')},"./src/js/favicontab.js":function srcJsFavicontabJs(module,__webpack_exports__,__webpack_require__){eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _modules_favicontab__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./modules/favicontab */ "./src/js/modules/favicontab.js");\n\n\nconst board  = document.getElementById("board");\nconst header = document.getElementById("header");\ndocument.body.style.backgroundColor = localStorage[\'backgroundColor\'];\n\nif(localStorage[\'placement\'] === "1") {\n    board.classList.add(\'manual\');\n    header.classList.add(\'manual\');\n} else {\n    board.classList.add(\'auto\');\n    header.classList.add(\'auto\');\n}\n\n\nconst actionController = document.getElementById("actionController");\nactionController.addEventListener("click",function(event) {\n  _modules_favicontab__WEBPACK_IMPORTED_MODULE_0__["default"].setBoradAction(event.target.id);\n});\n\n\n\n//events\nboard.addEventListener("click",function(event) {\n    if(event.target.dataset.id === undefined) {\n        return false;\n    }\n    if(event.target.dataset.url) {\n        //click favicon\n        switch(localStorage["linkTarget"]) {\n          case "0":\n            window.location.href = event.target.dataset.url;\n            break;\n          case "1":\n            window.open(event.target.dataset.url, \'_blank\');\n            break;\n          default:\n            break;\n        }\n    }\n    else {\n        if(localStorage[\'folderType\'] === "1" && localStorage[\'placement\'] === "0") {\n            if(event.target.dataset.status === \'close\') {\n                _modules_favicontab__WEBPACK_IMPORTED_MODULE_0__["default"].openFolder(event.target.dataset.id);\n            } \n            else {\n                _modules_favicontab__WEBPACK_IMPORTED_MODULE_0__["default"].closeFolder(event.target.dataset.id);\n            }\n        } \n        else {\n            if(localStorage[\'placement\'] === \'0\') {\n                _modules_favicontab__WEBPACK_IMPORTED_MODULE_0__["default"].faviconDisplay(event.target.dataset.id);\n            } \n            else {\n                _modules_favicontab__WEBPACK_IMPORTED_MODULE_0__["default"].faviconDisplayManual(event.target.dataset.id);\n            }\n        }\n    }\n},false);\n\nif(localStorage[\'placement\'] === "0") {\n    board.addEventListener(\'dragover\',   function(event){\n        event.preventDefault();\n        event.dataTransfer.dropEffect = \'move\';\n    }, false);\n    board.addEventListener(\'drop\',function(event){\n        if(event.target.dataset.id === undefined) {\n            return;\n        }\n        const el = document.getElementsByClassName(\'draging\');\n        const bookmarkId  = el[0].dataset.id;\n        let   changeIndex = Number(event.target.dataset.index);\n        if(event.target.dataset.url) {\n            //to favicon\n            if(changeIndex > el[0].dataset.index) {\n              changeIndex =  changeIndex+1;\n            }\n            chrome.bookmarks.move(bookmarkId, {"index": changeIndex});\n        }\n        else {\n            //to folder\n            chrome.bookmarks.move(bookmarkId, {"parentId": event.target.dataset.id});\n        }\n        _modules_favicontab__WEBPACK_IMPORTED_MODULE_0__["default"].faviconDisplay(event.target.dataset.pid);\n    }, false);\n    //load\n    _modules_favicontab__WEBPACK_IMPORTED_MODULE_0__["default"].faviconDisplay(localStorage[\'useFolder\']);\n}\nelse {\n    //load\n    _modules_favicontab__WEBPACK_IMPORTED_MODULE_0__["default"].faviconDisplayManual(localStorage[\'useFolder\']);\n}\n\n\n\n\n\n//# sourceURL=webpack:///./src/js/favicontab.js?')},"./src/js/modules/favicontab.js":function srcJsModulesFavicontabJs(module,__webpack_exports__,__webpack_require__){eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _const__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../const */ \"./src/js/const.js\");\n\n\n/* harmony default export */ __webpack_exports__[\"default\"] = ({\n  faviconDisplay: function(parentId) {\n    const mainBoard    = document.createElement('main');\n    const _this        = this;\n    if(board.childNodes[0]) {\n      board.removeChild(board.childNodes[0]);\n    }\n    if(parentId != localStorage['useFolder']) {\n      this.setBackFolder(parentId, mainBoard);\n    }\n    chrome.bookmarks.getChildren(parentId,function(roots){\n      roots.forEach(function (node){\n        _this.setIcon(node, mainBoard);\n      });\n      board.appendChild(mainBoard);\n    });\n  }, \n\n  faviconDisplayManual: function(parentId) {\n    const _this        = this;\n    const mainBoard    = document.createElement('main');\n    const storageKey   = _const__WEBPACK_IMPORTED_MODULE_0__[\"default\"].positionPrefix+parentId;\n    const positions    = JSON.parse(localStorage.getItem(storageKey));\n    const positionData = {};\n    if(board.childNodes[0]) {\n      board.removeChild(board.childNodes[0]);\n    }\n    if(parentId != localStorage['useFolder']) {\n      this.setBackFolder(parentId, mainBoard);\n    }\n\n    chrome.bookmarks.getChildren(parentId,function(roots){\n      //loop\n      roots.forEach(function (node){\n        if(!positions || typeof positions[node.id] === \"undefined\") {\n          //座標なし\n          _this.setIcon(node, mainBoard);\n        }\n        else {\n          //座標あり\n          positionData[node.id] = positions[node.id];\n          const posi = positions[node.id].split(',');\n          //出力\n          const icon = _this.setIcon(node, mainBoard);\n          icon.setAttribute('style','position:absolute;top:'+posi[0]+'px;left:'+posi[1]+'px;');\n        }\n      });\n      board.appendChild(mainBoard);\n      //描写毎に削除されたブックマークなどのデータを取り除くため、ローカルストレージ内のデータを更新する。\n      localStorage.setItem(storageKey, JSON.stringify(positionData)); //refresh\n    });\n  },\n\n  setBackFolder: function(bookmarkId, el) {\n    chrome.bookmarks.get(String(bookmarkId), function(items) {\n      const img = document.createElement('img');\n      img.setAttribute('src',        '/img/folder_open.svg');\n      img.setAttribute('class',      'icon folder');\n      img.setAttribute('id',         _const__WEBPACK_IMPORTED_MODULE_0__[\"default\"].idPrefix+items[0].parentId);\n      img.setAttribute('data-id',    items[0].parentId);\n      img.setAttribute('draggable',  'false');\n      if(localStorage['placement'] === \"1\") {\n        if(localStorage[_const__WEBPACK_IMPORTED_MODULE_0__[\"default\"].positionPrefix+items[0].parentId]) {\n          if(JSON.parse(localStorage[_const__WEBPACK_IMPORTED_MODULE_0__[\"default\"].positionPrefix+items[0].parentId])[items[0].id] !== undefined) {\n              const posi = JSON.parse(localStorage[_const__WEBPACK_IMPORTED_MODULE_0__[\"default\"].positionPrefix+items[0].parentId])[items[0].id].split(',');\n              img.setAttribute('style','position:absolute;top:'+posi[0]+'px;left:'+posi[1]+'px;');\n          }\n        }\n      }\n      el.insertBefore(img, el.firstChild);\n    });\n  },\n\n  setIcon: function(node, el) {\n    const img   = document.createElement('img');\n    const key   = _const__WEBPACK_IMPORTED_MODULE_0__[\"default\"].notExistPrefix+node.parentId;\n    const _this = this;\n    let withoutIcons = JSON.parse(localStorage.getItem(key));\n    img.addEventListener(\"dragstart\", function(event){_this.dragstart(event)}, false);\n    img.setAttribute('id',         _const__WEBPACK_IMPORTED_MODULE_0__[\"default\"].idPrefix+node.id);\n    img.setAttribute('title',      node.title);\n    img.setAttribute('data-id',    node.id);\n    img.setAttribute('data-index', node.index);\n    img.setAttribute('data-pid',   node.parentId);\n    img.setAttribute('draggable', 'true');\n    if(typeof node.url !== \"undefined\") {\n      //favicon\n      if (withoutIcons == null || typeof(withoutIcons[node.id]) == \"undefined\") {\n        img.setAttribute('src',      'chrome://favicon/'+node.url);\n      }\n      else {\n        img.setAttribute('src',      '/img/defaultIcon.png');\n      }\n      img.setAttribute('class',     'icon favicon');\n      img.setAttribute('data-url',   node.url);\n        \n      img.onload = function() {\n        const canvas = document.createElement('canvas');\n        canvas.width  = this.width;\n        canvas.height = this.height;\n        const ctx = canvas.getContext('2d');\n        ctx.drawImage(this, 0, 0);\n        const defaultIcon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAYklEQVQ4T2NkoBAwIuuPior6j8O8xmXLljVgk8MwYNmyZdgMfcjAwLAAmyFEGfDv3z9FJiamA9gMIcoAkKsiIiIUsBlClAHofkf2JkED0DWDAnrUgOEfBsRkTpzpgBjN6GoA24V1Efr1zoAAAAAASUVORK5CYII=';\n        if(canvas.toDataURL() === defaultIcon) {\n          let withoutIcons = JSON.parse(localStorage.getItem(key));\n          if(withoutIcons == null) {\n            withoutIcons = {};\n          }\n          withoutIcons[node.id] = 1;\n          localStorage.setItem(key, JSON.stringify(withoutIcons)); //refresh\n        }\n      };\n      el.appendChild(img);\n    }\n    else {\n      //folder\n      img.setAttribute('src',         '/img/folder.svg');\n      img.setAttribute('class',       'icon folder');\n      img.setAttribute('data-status', 'close');\n      if(localStorage['placement'] === \"0\") {\n        //span\n        const span = document.createElement('span');\n        span.setAttribute('id',         'parentFolder'+node.id);\n        span.appendChild(img);\n        el.appendChild(span);\n      } \n      else {\n        el.appendChild(img);\n      }\n    }\n    return img;\n  },\n\n  dragstart: function(event){\n    const el = document.getElementById(event.target.id);\n    const x = event.pageX - el.offsetLeft;\n    const y = event.pageY - el.offsetTop;\n    el.classList.add('draging');\n    if(localStorage['placement'] == \"1\") {\n      el.addEventListener(\"drag\", function(event) {\n        this.style.position = 'absolute';\n        this.style.top      = event.pageY - y + \"px\";\n        this.style.left     = event.pageX - x + \"px\";\n        this.addEventListener(\"dragover\",function(event){\n          event.preventDefault();\n          event.dataTransfer.dropEffect = 'move';\n        }, false);\n      }, false);\n      el.addEventListener(\"dragend\", function(event) {\n        const storageKey = _const__WEBPACK_IMPORTED_MODULE_0__[\"default\"].positionPrefix+event.target.dataset.pid;\n        const positions  = JSON.parse(localStorage.getItem(storageKey));\n        const top        = this.style.top.slice(0, -2);\n        const left       = this.style.left.slice(0,-2);\n        if(Number(left) < 0 || Number(top) < 0 ) {\n          if(positions[event.target.dataset.id]) {\n            const posi = positions[event.target.dataset.id].split(',');\n            this.style.top      = posi[0]+\"px\";\n            this.style.left     = posi[1]+\"px\";\n          }\n          else {\n            this.style.position = 'none';\n            this.style.top      = null;\n            this.style.left     = null;\n          }\n        }\n        else {\n          positions[event.target.dataset.id] = top+','+left; \n          localStorage.setItem(storageKey, JSON.stringify(positions));\n        }\n        this.classList.remove(\"draging\");\n      },false);\n    }\n  },\n\n  openFolder: function(id) {\n    const folderIcon = document.getElementById(_const__WEBPACK_IMPORTED_MODULE_0__[\"default\"].idPrefix+id);\n    folderIcon.setAttribute('data-status', 'open');\n    folderIcon.setAttribute('src',       '/img/folder_open.svg');\n    const pSpan       = document.getElementById('parentFolder'+id);\n    const cSpan       = document.createElement('span');\n    cSpan.setAttribute('id','childFolder'+id);\n    pSpan.appendChild(cSpan);\n\n    chrome.bookmarks.getChildren(id, function(roots){\n      roots.forEach(function (node){\n        this.setIcon(node, cSpan);\n      });\n    });\n  },\n    \n  closeFolder: function(id) {\n    const folderIcon = document.getElementById(_const__WEBPACK_IMPORTED_MODULE_0__[\"default\"].idPrefix+id);\n    folderIcon.setAttribute('data-status', 'close');\n    folderIcon.setAttribute('src',       '/img/folder.svg');\n    document.getElementById('childFolder'+id).remove();\n  }\n\n  ,\n  setBoradAction: function(targetId) {\n    if(!targetId.length) {\n       return;\n    }\n    const value = document.getElementById(targetId).getAttribute('value');\n    document.getElementById(\"board\").dataset.action = value;\n  }\n});\n\n\n\n//# sourceURL=webpack:///./src/js/modules/favicontab.js?")}});