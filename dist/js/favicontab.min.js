"use strict";var idPrefix="bid",keyPrefix="positions",board=document.getElementById("board");document.body.style.backgroundColor=localStorage.backgroundColor;var x=void 0,y=void 0,setPositions={};"1"===localStorage.placement?board.classList.add("manual"):board.classList.add("auto");var faviconDisplay=function(t){var e=document.createElement("main");board.childNodes[0]&&board.removeChild(board.childNodes[0]),t!=localStorage.useFolder&&setBackFolder(t,e),chrome.bookmarks.getChildren(t,function(t){t.forEach(function(t){output(t,e)}),board.appendChild(e)})},faviconDisplayManual=function(t){var a=document.createElement("main"),e=keyPrefix+t,r=JSON.parse(localStorage.getItem(e));board.childNodes[0]&&board.removeChild(board.childNodes[0]),t!=localStorage.useFolder&&setBackFolder(t,a),chrome.bookmarks.getChildren(t,function(t){t.forEach(function(t){if(r&&void 0!==r[t.id]){setPositions[t.id]=r[t.id];var e=r[t.id].split(",");output(t,a).setAttribute("style","position:absolute;top:"+e[0]+"px;left:"+e[1]+"px;")}else output(t,a)}),board.appendChild(a),localStorage.setItem(e,JSON.stringify(setPositions))})},setBackFolder=function(t,r){chrome.bookmarks.get(String(t),function(t){var e=document.createElement("img");if(e.setAttribute("src","/img/folder_open.svg"),e.setAttribute("class","icon folder"),e.setAttribute("id",idPrefix+t[0].parentId),e.setAttribute("data-id",t[0].parentId),e.setAttribute("draggable","false"),"1"===localStorage.placement&&localStorage[keyPrefix+t[0].parentId]&&void 0!==JSON.parse(localStorage[keyPrefix+t[0].parentId])[t[0].id]){var a=JSON.parse(localStorage[keyPrefix+t[0].parentId])[t[0].id].split(",");e.setAttribute("style","position:absolute;top:"+a[0]+"px;left:"+a[1]+"px;")}r.insertBefore(e,r.firstChild)})},output=function(t,e){var a=document.createElement("img");if(a.addEventListener("dragstart",dragstart,!1),a.setAttribute("id",idPrefix+t.id),a.setAttribute("title",t.title),a.setAttribute("data-id",t.id),a.setAttribute("data-index",t.index),a.setAttribute("data-pid",t.parentId),a.setAttribute("draggable","true"),void 0!==t.url)a.setAttribute("src","chrome://favicon/"+t.url),a.setAttribute("class","icon favicon"),a.setAttribute("data-url",t.url),e.appendChild(a);else if(a.setAttribute("src","/img/folder.svg"),a.setAttribute("class","icon folder"),a.setAttribute("data-status","close"),"0"===localStorage.placement){var r=document.createElement("span");r.setAttribute("id","parentFolder"+t.id),r.appendChild(a),e.appendChild(r)}else e.appendChild(a);return a},click=function(t){if(void 0===t.target.dataset.id)return!1;if(t.target.dataset.url)switch(localStorage.linkTarget){case"0":window.location.href=t.target.dataset.url;break;case"1":window.open(t.target.dataset.url,"_blank")}else"1"===localStorage.folderType&&"0"===localStorage.placement?"close"===t.target.dataset.status?openFolder(t.target.dataset.id):closeFolder(t.target.dataset.id):"0"===localStorage.placement?faviconDisplay(t.target.dataset.id):faviconDisplayManual(t.target.dataset.id)},dragstart=function(t){var e=document.getElementById(t.target.id);e.classList.add("draging"),x=t.pageX-this.offsetLeft,y=t.pageY-this.offsetTop,"1"===localStorage.placement&&e.addEventListener("drag",drag,!1)},drag=function(t){var e=document.getElementsByClassName("draging");e[0].style.position="absolute",e[0].style.top=t.pageY-y+"px",e[0].style.left=t.pageX-x+"px",e[0].addEventListener("dragend",dragend,!1),e[0].addEventListener("dragover",dragover,!1)},dragend=function(t){var e=document.getElementsByClassName("draging");if("1"===localStorage.placement){var a=e[0].style.top.slice(0,-2),r=e[0].style.left.slice(0,-2);if(Number(r)<0||Number(a)<0)if(setPositions[t.target.dataset.id]){var o=setPositions[t.target.dataset.id].split(",");e[0].style.top=o[0]+"px",e[0].style.left=o[1]+"px"}else e[0].style.position="none",e[0].style.top=null,e[0].style.left=null;else{var d=keyPrefix+t.target.dataset.pid;setPositions[t.target.dataset.id]=a+","+r,localStorage.setItem(d,JSON.stringify(setPositions))}}e[0].classList.remove("draging")},dragover=function(t){t.preventDefault(),t.dataTransfer.dropEffect="move"},drop=function(t){if(void 0!==t.target.dataset.id){var e=document.getElementsByClassName("draging"),a=e[0].dataset.id,r=Number(t.target.dataset.index);t.target.dataset.url?(r>e[0].dataset.index&&(r+=1),chrome.bookmarks.move(a,{index:r})):chrome.bookmarks.move(a,{parentId:t.target.dataset.id}),faviconDisplay(t.target.dataset.pid)}},openFolder=function(t){var e=document.getElementById(idPrefix+t);e.setAttribute("data-status","open"),e.setAttribute("src","/img/folder_open.svg");var a=document.getElementById("parentFolder"+t),r=document.createElement("span");r.setAttribute("id","childFolder"+t),a.appendChild(r),chrome.bookmarks.getChildren(t,function(t){t.forEach(function(t){output(t,r)})})},closeFolder=function(t){var e=document.getElementById(idPrefix+t);e.setAttribute("data-status","close"),e.setAttribute("src","/img/folder.svg"),document.getElementById("childFolder"+t).remove()};board.addEventListener("click",click,!1),"0"===localStorage.placement&&(board.addEventListener("dragover",dragover,!1),board.addEventListener("drop",drop,!1)),"0"===localStorage.placement?faviconDisplay(localStorage.useFolder):faviconDisplayManual(localStorage.useFolder);